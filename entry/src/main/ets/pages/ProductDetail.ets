import router from '@ohos.router';
import promptAction from '@ohos.promptAction';
import { DataService } from '../utils/DataService';
import { Product } from '../models/Models';

@Entry
@Component
struct ProductDetail {
  @State product: Product | undefined = undefined;
  @State quantity: number = 1;

  aboutToAppear() {
    // è·å–è·¯ç”±å‚æ•°
    const params = router.getParams() as Record<string, Object>;
    if (params && params.productId) {
      const productId = params.productId as number;
      this.product = DataService.getProductById(productId);
    }
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('â†')
          .fontSize(24)
          .onClick(() => {
            router.back();
          })
          .margin({ right: 15 })
        
        Text('å•†å“è¯¦æƒ…')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
        
        Blank()
        
        Text('ğŸ›’ ' + DataService.getCartItemCount())
          .fontSize(18)
          .onClick(() => {
            router.pushUrl({ url: 'pages/Cart' });
          })
      }
      .width('100%')
      .height(60)
      .padding({ left: 20, right: 20 })
      .backgroundColor('#FFFFFF')

      if (this.product) {
        Scroll() {
          Column() {
            // å•†å“å›¾ç‰‡
            Text('ğŸ“·')
              .fontSize(120)
              .width('100%')
              .height(300)
              .textAlign(TextAlign.Center)
              .backgroundColor('#FFFFFF')
              .margin({ bottom: 10 })

            // å•†å“ä¿¡æ¯
            Column() {
              Text(this.product.name)
                .fontSize(20)
                .fontWeight(FontWeight.Bold)
                .margin({ bottom: 10 })
              
              Text(this.product.description)
                .fontSize(14)
                .fontColor('#666666')
                .margin({ bottom: 15 })
              
              Row() {
                Text('Â¥')
                  .fontSize(16)
                  .fontColor('#FF6600')
                Text(this.product.price.toString())
                  .fontSize(28)
                  .fontColor('#FF6600')
                  .fontWeight(FontWeight.Bold)
              }
              .margin({ bottom: 15 })

              Row() {
                Text('åº“å­˜: ' + this.product.stock)
                  .fontSize(14)
                  .fontColor('#999999')
                
                Blank()
                
                Text('åˆ†ç±»: ' + this.product.category)
                  .fontSize(14)
                  .fontColor('#999999')
              }
              .width('100%')
            }
            .width('100%')
            .padding(20)
            .backgroundColor('#FFFFFF')
            .margin({ bottom: 10 })

            // è´­ä¹°æ•°é‡é€‰æ‹©
            Column() {
              Row() {
                Text('è´­ä¹°æ•°é‡')
                  .fontSize(16)
                
                Blank()
                
                Row() {
                  Text('-')
                    .fontSize(24)
                    .width(40)
                    .height(40)
                    .textAlign(TextAlign.Center)
                    .backgroundColor('#F5F5F5')
                    .borderRadius(5)
                    .onClick(() => {
                      if (this.quantity > 1) {
                        this.quantity--;
                      }
                    })
                  
                  Text(this.quantity.toString())
                    .fontSize(18)
                    .width(60)
                    .textAlign(TextAlign.Center)
                  
                  Text('+')
                    .fontSize(24)
                    .width(40)
                    .height(40)
                    .textAlign(TextAlign.Center)
                    .backgroundColor('#F5F5F5')
                    .borderRadius(5)
                    .onClick(() => {
                      if (this.quantity < this.product.stock) {
                        this.quantity++;
                      } else {
                        promptAction.showToast({
                          message: 'è¶…è¿‡åº“å­˜æ•°é‡',
                          duration: 2000
                        });
                      }
                    })
                }
              }
              .width('100%')
            }
            .width('100%')
            .padding(20)
            .backgroundColor('#FFFFFF')
            .margin({ bottom: 10 })

            // å•†å“è¯¦æƒ…è¯´æ˜
            Column() {
              Text('å•†å“è¯¦æƒ…')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .margin({ bottom: 15 })
              
              Text('è¿™æ˜¯ä¸€æ¬¾ä¼˜è´¨çš„å•†å“ï¼Œè´¨é‡å¯é ï¼Œæ€§èƒ½å‡ºè‰²ã€‚é‡‡ç”¨å…ˆè¿›æŠ€æœ¯æ‰“é€ ï¼Œä¸ºæ‚¨å¸¦æ¥å“è¶Šçš„ä½¿ç”¨ä½“éªŒã€‚')
                .fontSize(14)
                .fontColor('#666666')
                .lineHeight(24)
            }
            .width('100%')
            .padding(20)
            .backgroundColor('#FFFFFF')
            .alignItems(HorizontalAlign.Start)
          }
          .width('100%')
        }
        .width('100%')
        .layoutWeight(1)

        // åº•éƒ¨æ“ä½œæ 
        Row() {
          Button('åŠ å…¥è´­ç‰©è½¦')
            .width('45%')
            .height(50)
            .fontSize(16)
            .backgroundColor('#FFA500')
            .borderRadius(25)
            .onClick(() => {
              DataService.addToCart(this.product!, this.quantity);
              promptAction.showToast({
                message: 'å·²æ·»åŠ åˆ°è´­ç‰©è½¦',
                duration: 2000
              });
            })
          
          Button('ç«‹å³è´­ä¹°')
            .width('45%')
            .height(50)
            .fontSize(16)
            .backgroundColor('#FF6600')
            .borderRadius(25)
            .onClick(() => {
              DataService.addToCart(this.product!, this.quantity);
              router.pushUrl({ url: 'pages/Cart' });
            })
        }
        .width('100%')
        .height(80)
        .padding({ left: 20, right: 20 })
        .backgroundColor('#FFFFFF')
        .justifyContent(FlexAlign.SpaceBetween)
      } else {
        Column() {
          Text('å•†å“ä¸å­˜åœ¨')
            .fontSize(18)
            .fontColor('#999999')
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }
}
